<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟DOM | ALeeLee 的博客 ｜ ALeeLee Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="个人博客，前端开发">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.13617540.css" as="style"><link rel="preload" href="/assets/js/app.2f6d7528.js" as="script"><link rel="preload" href="/assets/js/8.de1e1474.js" as="script"><link rel="preload" href="/assets/js/35.5eb6c0e1.js" as="script"><link rel="prefetch" href="/assets/js/10.a0bbe185.js"><link rel="prefetch" href="/assets/js/11.f371666a.js"><link rel="prefetch" href="/assets/js/12.69129269.js"><link rel="prefetch" href="/assets/js/13.7aa5ea5e.js"><link rel="prefetch" href="/assets/js/14.77cfc569.js"><link rel="prefetch" href="/assets/js/15.61215e4c.js"><link rel="prefetch" href="/assets/js/16.2ef95e40.js"><link rel="prefetch" href="/assets/js/17.2475d3a2.js"><link rel="prefetch" href="/assets/js/18.55eec7bb.js"><link rel="prefetch" href="/assets/js/19.e31e3f70.js"><link rel="prefetch" href="/assets/js/2.b1431340.js"><link rel="prefetch" href="/assets/js/20.b347f436.js"><link rel="prefetch" href="/assets/js/21.fdb44a3f.js"><link rel="prefetch" href="/assets/js/22.9dc5f344.js"><link rel="prefetch" href="/assets/js/23.4b988abf.js"><link rel="prefetch" href="/assets/js/24.4096f69f.js"><link rel="prefetch" href="/assets/js/25.a023eca1.js"><link rel="prefetch" href="/assets/js/26.fa41ae05.js"><link rel="prefetch" href="/assets/js/27.6b737c17.js"><link rel="prefetch" href="/assets/js/28.627e72c1.js"><link rel="prefetch" href="/assets/js/29.f447b265.js"><link rel="prefetch" href="/assets/js/3.08df3fc1.js"><link rel="prefetch" href="/assets/js/30.f0b58d8b.js"><link rel="prefetch" href="/assets/js/31.772a1210.js"><link rel="prefetch" href="/assets/js/32.b61498e2.js"><link rel="prefetch" href="/assets/js/33.95cd4cee.js"><link rel="prefetch" href="/assets/js/34.5b644dad.js"><link rel="prefetch" href="/assets/js/36.b33dc8c3.js"><link rel="prefetch" href="/assets/js/37.7517cacd.js"><link rel="prefetch" href="/assets/js/4.2afa2c6b.js"><link rel="prefetch" href="/assets/js/5.cf1e02e8.js"><link rel="prefetch" href="/assets/js/6.a74a1282.js"><link rel="prefetch" href="/assets/js/7.f7523abb.js"><link rel="prefetch" href="/assets/js/9.3f84638a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.13617540.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout" data-v-7f2e4136><header class="header-container" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/post-bg.jpeg);" data-v-93921ff8 data-v-7f2e4136><nav class="navbar" style="position:absolute;opacity:1;transition:all 0.5s ease-in-out;" data-v-93921ff8><a href="/" class="navbar-link router-link-active">
    ALeeLee Blog
  </a> <ul class="navbar-links"><li><a href="/" class="router-link-active">
        HOME
      </a></li><li><a href="/about/">
        ABOUT
      </a></li><li><a href="/tags/">
        TAGS
      </a></li></ul> <div id="nav-icon"><span></span><span></span><span></span></div></nav> <div class="header-title" data-v-93921ff8 data-v-93921ff8><h1 data-v-93921ff8>虚拟DOM</h1> <p data-v-93921ff8></p></div></header> <div class="container" data-v-b3fda33c data-v-7f2e4136><main class="main" style="width:60%;" data-v-b3fda33c><div class="post" data-v-b3fda33c data-v-b3fda33c><article class="main-div"><div class="post-content content content__default"><p>虚拟DOM</p> <h2 id="_1-对虚拟dom的理解？"><a href="#_1-对虚拟dom的理解？" class="header-anchor">#</a> 1. 对虚拟DOM的理解？</h2> <p>从本质上来说，Virtual Dom是一个JavaScript对象，通过对象的方式来表示DOM结构。将页面的状态抽象为JS对象的形式，配合不同的渲染工具，使跨平台渲染成为可能。通过事务处理机制，将多次DOM修改的结果一次性的更新到页面上，从而有效的减少页面渲染的次数，减少修改DOM的重绘重排次数，提高渲染性能。</p> <p>虚拟DOM是对DOM的抽象，这个对象是更加轻量级的对 DOM的描述。它设计的最初目的，就是更好的跨平台，比如Node.js就没有DOM，如果想实现SSR，那么一个方式就是借助虚拟DOM，因为虚拟DOM本身是js对象。 在代码渲染到页面之前，vue会把代码转换成一个对象（虚拟 DOM）。以对象的形式来描述真实DOM结构，最终渲染到页面。在每次数据发生变化前，虚拟DOM都会缓存一份，变化之时，现在的虚拟DOM会与缓存的虚拟DOM进行比较。在vue内部封装了diff算法，通过这个算法来进行比较，渲染时修改改变的变化，原先没有发生改变的通过原先的数据进行渲染。</p> <p>另外现代前端框架的一个基本要求就是无须手动操作DOM，一方面是因为手动操作DOM无法保证程序性能，多人协作的项目中如果review不严格，可能会有开发者写出性能较低的代码，另一方面更重要的是省略手动DOM操作可以大大提高开发效率。</p> <h2 id="_2-虚拟dom的解析过程"><a href="#_2-虚拟dom的解析过程" class="header-anchor">#</a> 2. 虚拟DOM的解析过程</h2> <p>虚拟DOM的解析过程：</p> <ul><li>首先对将要插入到文档中的 DOM 树结构进行分析，使用 js 对象将其表示出来，比如一个元素对象，包含 TagName、props 和 Children 这些属性。然后将这个 js 对象树给保存下来，最后再将 DOM 片段插入到文档中。</li> <li>当页面的状态发生改变，需要对页面的 DOM 的结构进行调整的时候，首先根据变更的状态，重新构建起一棵对象树，然后将这棵新的对象树和旧的对象树进行比较，记录下两棵树的的差异。</li> <li>最后将记录的有差异的地方应用到真正的 DOM 树中去，这样视图就更新了。</li></ul> <h2 id="_3-为什么要用虚拟dom"><a href="#_3-为什么要用虚拟dom" class="header-anchor">#</a> 3. 为什么要用虚拟DOM</h2> <p><strong>（1）保证性能下限，在不进行手动优化的情况下，提供过得去的性能</strong> 看一下页面渲染的流程：<strong>解析HTML -&gt; 生成DOM -&gt; 生成 CSSOM -&gt; Layout -&gt; Paint -&gt; Compiler</strong> 下面对比一下修改DOM时真实DOM操作和Virtual DOM的过程，来看一下它们重排重绘的性能消耗∶</p> <ul><li>真实DOM∶ 生成HTML字符串＋重建所有的DOM元素</li> <li>虚拟DOM∶ 生成vNode+ DOMDiff＋必要的dom更新</li></ul> <p>Virtual DOM的更新DOM的准备工作耗费更多的时间，也就是JS层面，相比于更多的DOM操作它的消费是极其便宜的。尤雨溪在社区论坛中说道∶ 框架给你的保证是，你不需要手动优化的情况下，依然可以给你提供过得去的性能。 <strong>（2）跨平台</strong> Virtual DOM本质上是JavaScript的对象，它可以很方便的跨平台操作，比如服务端渲染、uniapp等。</p> <h2 id="_4-虚拟dom真的比真实dom性能好吗"><a href="#_4-虚拟dom真的比真实dom性能好吗" class="header-anchor">#</a> 4. 虚拟DOM真的比真实DOM性能好吗</h2> <ul><li>首次渲染大量DOM时，由于多了一层虚拟DOM的计算，会比innerHTML插入慢。</li> <li>正如它能保证性能下限，在真实DOM操作的时候进行针对性的优化时，还是更快的。</li></ul> <h2 id="_5-diff算法的原理"><a href="#_5-diff算法的原理" class="header-anchor">#</a> 5. DIFF算法的原理</h2> <p>在新老虚拟DOM对比时：</p> <ul><li>首先，对比节点本身，判断是否为同一节点，如果不为相同节点，则删除该节点重新创建节点进行替换</li> <li>如果为相同节点，进行patchVnode，判断如何对该节点的子节点进行处理，先判断一方有子节点一方没有子节点的情况(如果新的children没有子节点，将旧的子节点移除)</li> <li>比较如果都有子节点，则进行updateChildren，判断如何对这些新老节点的子节点进行操作（diff核心）。</li> <li>匹配时，找到相同的子节点，递归比较子节点</li></ul> <p>在diff中，只对同层的子节点进行比较，放弃跨级的节点比较，使得时间复杂从O(n3)降低值O(n)，也就是说，只有当新旧children都为多个子节点时才需要用核心的Diff算法进行同层级比较。</p> <h2 id="_6-vue中key的作用"><a href="#_6-vue中key的作用" class="header-anchor">#</a> 6. Vue中key的作用</h2> <p>vue 中 key 值的作用可以分为两种情况来考虑：</p> <ul><li>第一种情况是 v-if 中使用 key。由于 Vue 会尽可能高效地渲染元素，通常会复用已有元素而不是从头开始渲染。因此当使用 v-if 来实现元素切换的时候，如果切换前后含有相同类型的元素，那么这个元素就会被复用。如果是相同的 input 元素，那么切换前后用户的输入不会被清除掉，这样是不符合需求的。因此可以通过使用 key 来唯一的标识一个元素，这个情况下，使用 key 的元素不会被复用。这个时候 key 的作用是用来标识一个独立的元素。</li> <li>第二种情况是 v-for 中使用 key。用 v-for 更新已渲染过的元素列表时，它默认使用“就地复用”的策略。如果数据项的顺序发生了改变，Vue 不会移动 DOM 元素来匹配数据项的顺序，而是简单复用此处的每个元素。因此通过为每个列表项提供一个 key 值，来以便 Vue 跟踪元素的身份，从而高效的实现复用。这个时候 key 的作用是为了高效的更新渲染虚拟 DOM。</li></ul> <p>key 是为 Vue 中 vnode 的唯一标记，通过这个 key，diff 操作可以更准确、更快速</p> <ul><li>更准确：因为带 key 就不是就地复用了，在 sameNode 函数a.key === b.key对比中可以避免就地复用的情况。所以会更加准确。</li> <li>更快速：利用 key 的唯一性生成 map 对象来获取对应节点，比遍历方式更快</li></ul> <h2 id="_7-为什么不建议用index作为key"><a href="#_7-为什么不建议用index作为key" class="header-anchor">#</a> 7. 为什么不建议用index作为key?</h2> <p>使用index 作为 key和没写基本上没区别，因为不管数组的顺序怎么颠倒，index 都是 0, 1, 2...这样排列，导致 Vue 会复用错误的旧子节点，做很多额外的工作。</p></div></article> <!----></div></main> <aside class="aside" data-v-b3fda33c data-v-b3fda33c><div class="info-card main-div" data-v-1311ce9e data-v-b3fda33c><div class="info-card-header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/avatar-bg.jpeg);" data-v-1311ce9e><img src="/avatar-top.jpg" alt="ALeeLee" class="info-avatar" data-v-1311ce9e></div> <div class="info-card-body" data-v-1311ce9e><section class="info-name" data-v-1311ce9e>
      ALeeLee
    </section> <section class="info-desc" data-v-1311ce9e>In me the tiger sniffs the rose<br/>心有猛虎，细嗅蔷薇</section> <section class="info-contact" data-v-1311ce9e><section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-location" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          Chongqing, China
        </span></span></section> <!----> <section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-email" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          1102721073@qq.com
        </span></span></section></section></div> <div class="info-card-footer" data-v-1311ce9e><p class="footer-sns-link" data-v-1311ce9e><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-jianshu" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" href="" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-weibo" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-zhihu" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-github" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a></p></div></div> <div class="post-toc main-div aside-toc" style="position:relative;top:0;width:0px;" data-v-b3fda33c><h4>- CATALOG</h4> <div class="post-nav-toc"><ul><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_1-对虚拟dom的理解？">1. 对虚拟DOM的理解？</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_2-虚拟dom的解析过程">2. 虚拟DOM的解析过程</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_3-为什么要用虚拟dom">3. 为什么要用虚拟DOM</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_4-虚拟dom真的比真实dom性能好吗">4. 虚拟DOM真的比真实DOM性能好吗</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_5-diff算法的原理">5. DIFF算法的原理</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_6-vue中key的作用">6. Vue中key的作用</a></li><li><a href="/posts/2022/08/08/%E8%99%9A%E6%8B%9Fdom.html#_7-为什么不建议用index作为key">7. 为什么不建议用index作为key?</a></li></ul></div></div></aside></div> <footer class="footer" data-v-7f2e4136><p class="footer-sns-link"><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-jianshu"></use></svg></span></a><a target="_blank" href="" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-weibo"></use></svg></span></a><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-zhihu"></use></svg></span></a><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-github"></use></svg></span></a></p> <div class="copyright"><span id="custom">Copyright &copy; ALeeLee Blog 2020 <br /> 
      Theme By <a href="https://www.vuepress.cn/" target="_blank">VuePress</a>
      | <a href="https://www.github.com/youdeliang/" target="_blank">youdeliang</a></span> <iframe frameborder="0" scrolling="0" width="80px" height="20px" class="footer-btn" style="margin-left: 2px; margin-bottom:-5px;"></iframe></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.2f6d7528.js" defer></script><script src="/assets/js/8.de1e1474.js" defer></script><script src="/assets/js/35.5eb6c0e1.js" defer></script>
  </body>
</html>
